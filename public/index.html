<script>
    const socket = io("https://torrent-downloader-5th2.onrender.com");

    socket.on("torrent-added", (data) => {
        console.log("Torrent added:", data);
        document.getElementById("loader").style.display = "none";
        const container = document.getElementById("filesContainer");
        container.innerHTML = `<h3>Downloading: ${data.folderName}</h3>`;

        data.files.forEach(file => {
            const fileLink = document.createElement("a");
            fileLink.href = `https://torrent-downloader-5th2.onrender.com${file.downloadLink}`;
            fileLink.textContent = `Download ${file.name}`;
            fileLink.setAttribute("download", file.name);
            fileLink.style.display = "block";
            container.appendChild(fileLink);
        });
    });

    function startDownload() {
        const magnetLink = document.getElementById("magnetLink").value;
        console.log("Submitting Magnet Link:", magnetLink);

        if (!magnetLink) {
            alert("Please enter a magnet link!");
            return;
        }

        document.getElementById("loader").innerHTML = `<div class="loader"></div>`;
        document.getElementById("loader").style.display = "block";

        fetch("https://torrent-downloader-5th2.onrender.com/download", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ magnet: magnetLink }),
        })
        .then(response => response.json())
        .then(data => {
            console.log("Server Response:", data);
        })
        .catch(error => {
            console.error("Error:", error);
        });
    }
</script>
