<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Torrent Downloader</title>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <style>
        /* Your previous styles */
    </style>
</head>
<body>

    <h1>Torrent Downloader</h1>
    <input type="text" id="magnetLink" placeholder="Enter Magnet Link">
    <button onclick="startDownload()">Download</button>

    <div id="loader" style="display: none;"></div>
    <div id="filesContainer"></div>

    <div class="warning-banner">
        ‚ö†Ô∏è Do NOT close or refresh this page! Your download will be lost forever in the void. üöÄ
    </div>

    <script>
        const socket = io("https://torrent-downloader-5th2.onrender.com");

        socket.on("torrent-added", (data) => {
            console.log("Torrent added:", data);
            document.getElementById("loader").style.display = "none";
            const container = document.getElementById("filesContainer");
            container.innerHTML = `<h3>Downloading: ${data.folderName}</h3>`;

            const progressContainer = document.createElement("div");
            progressContainer.classList.add("progress-container");

            const progressBar = document.createElement("div");
            progressBar.classList.add("progress-bar");
            progressBar.innerHTML = `<div class="progress" id="progress-bar"></div>`;

            const progressText = document.createElement("div");
            progressText.classList.add("progress-text");
            progressText.id = "progress-text";
            progressText.innerText = "0%";

            progressContainer.appendChild(progressBar);
            progressContainer.appendChild(progressText);
            container.appendChild(progressContainer);

            const message = document.createElement("div");
            message.classList.add("message");
            message.id = "download-message";
            message.innerText = "Download Completed!";
            container.appendChild(message);

            // Add download buttons for the files
            data.files.forEach(file => {
                const fileLink = document.createElement("a");
                fileLink.href = file.downloadLink;
                fileLink.innerText = `Download ${file.name}`;
                fileLink.target = "_blank";
                container.appendChild(fileLink);
                container.appendChild(document.createElement("br"));
            });
        });

        socket.on("progress", (data) => {
            console.log("Progress update:", data);
            if (data.type === "download") {
                document.getElementById("progress-bar").style.width = data.progress + "%";
                document.getElementById("progress-text").innerText = data.progress + "%";
            } else if (data.type === "done") {
                document.getElementById("download-message").style.display = "block";
            }
        });

        function startDownload() {
            const magnetLink = document.getElementById("magnetLink").value;
            console.log("Submitting Magnet Link:", magnetLink);

            if (!magnetLink) {
                alert("Please enter a magnet link!");
                return;
            }

            document.getElementById("loader").innerHTML = `<div class="loader"></div>`;
            document.getElementById("loader").style.display = "block";

            fetch("https://torrent-downloader-5th2.onrender.com/download", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ magnet: magnetLink }),
            })
            .then(response => response.json())
            .then(data => {
                console.log("Server Response:", data);
            })
            .catch(error => {
                console.error("Error:", error);
            });
        }
    </script>

</body>
</html>
